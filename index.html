<!doctype html>
<html>
	<head>
		<title>VEX Data</title>
		<link rel="stylesheet" href="style.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue-red.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
	</head>
	<body>
		<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
			<header class="mdl-layout__header">
				<div class="mdl-layout__header-row">
					<a class="mdl-layout-title mdl-color-text--white" href="../">VEX Data</a>
					<div class="mdl-layout-spacer"></div>
					<nav class="mdl-navigation mdl-layout--large-screen-only">
						<a class="mdl-navigation__link" href="./teams">Teams</a>
						<a class="mdl-navigation__link" href="./events">Events</a>
						<a class="mdl-navigation__link" href="./skills">Skills</a>
					</nav>
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
						<label class="mdl-button mdl-js-button mdl-button--icon" for="fixed-header-drawer-exp">
							<i class="material-icons">search</i>
						</label>
						<div class="mdl-textfield__expandable-holder">
							<input class="mdl-textfield__input" type="text" name="sample" id="fixed-header-drawer-exp">
						</div>
					</div>
				</div>
			</header>
			<div class="mdl-layout__drawer mdl-layout--small-screen-only">
				<a class="mdl-layout-title mdl-color-text--grey-800" href="../">VEX Data</a>
				<nav class="mdl-navigation">
					<a class="mdl-navigation__link" href="./teams">Teams</a>
					<a class="mdl-navigation__link" href="./events">Events</a>
					<a class="mdl-navigation__link" href="./skills">Skills</a>
				</nav>
			</div>
			<main class="mdl-layout__content">
				<div class="page-content">
					<div class="mdl-grid">
						<div class="mdl-cell mdl-cell--6-col mdl-cell--top mdl-card mdl-shadow--2dp">
							<div class="mdl-card__title">
								<h2 class="mdl-card__title-text">Events</h2>
							</div>
							<div class="mdl-card__data">
								<table class="mdl-data-table mdl-js-data-table wrappable" id="events-table">
									<thead>
										<tr>
											<th>Dates</th>
											<th>Location</th>
											<th class="mdl-data-table__cell--non-numeric">Name</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
							<div class="mdl-spinner mdl-js-spinner" id="events-spinner"></div>
							<div class="mdl-card__actions mdl-card--border">
								<a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="./events">View All</a>
							</div>
						</div>
						<div class="mdl-cell mdl-cell--6-col mdl-cell--top mdl-card mdl-shadow--2dp">
							<div class="mdl-card__title">
								<h2 class="mdl-card__title-text">Skills</h2>
							</div>
							<div class="mdl-card__data">
								<table class="mdl-data-table mdl-js-data-table" id="skills-table">
									<thead>
										<tr>
											<th>Rank</th>
											<th>Team</th>
											<th>Score</th>
											<th>Programming</th>
											<th>Driver</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
							<div class="mdl-spinner mdl-js-spinner" id="skills-spinner"></div>
							<div class="mdl-card__actions mdl-card--border">
								<a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="./skills">View All</a>
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>
	</body>
</html>

<script>
$(document).ready(function() {
	document.getElementById('events-spinner').classList.add('is-active');
	document.getElementById('events-spinner').classList.remove('hidden');
	$.getJSON('/api/currentEvents', function(data) {
		var events = '';
		$.each(data, function(key, value) {
			events += '<tr>';
			events += `<td>${value.dates}</td>`;
			events += `<td>${value.location}</td>`;
			events += `<td class="mdl-data-table__cell--non-numeric">${value.name}</td>`;
			events += '</tr>';
		});
		document.getElementById('events-spinner').classList.add('hidden');
		document.getElementById('events-spinner').classList.remove('is-active');
		$('#events-table > tbody').append(events);
	});

	document.getElementById('skills-spinner').classList.add('is-active');
	document.getElementById('skills-spinner').classList.remove('hidden');
	$.getJSON('/api/topSkills?limit=30', function(data) {
		var skills = '';
		$.each(data, function(key, value) {
			var prog = decodeProg(value.team.prog);
			var id = value.team.id;
			skills += `<tr>`;
			skills += teamCell(prog, id, value._id.rank);
			skills += teamCell(prog, id, id);
			skills += teamCell(prog, id, value.score);
			skills += teamCell(prog, id, value.prog);
			skills += teamCell(prog, id, value.driver);
			skills += '</tr>';
		});
		document.getElementById('skills-spinner').classList.add('hidden');
		document.getElementById('skills-spinner').classList.remove('is-active');
		$('#skills-table > tbody').append(skills);
	});
});

function teamCell(prog, id, data) {
	return `<td><a class="mdl-color-text--black" href="../team/${prog}/${id}">${data}</a></td>`;
}

var progs = {
	1: 'VRC',
	4: 'VEXU',
	37: 'CREATE',
	40: 'WORKSHOP',
	41: 'VIQC'
};

function decodeProg(prog) {
	return progs[prog];
}
</script>
